# 接口文档v2.0

> 写在前面: 
>
> 防止再次出现工作失误 请开发岗的友友们开发进度尽量和接口文档一致 每个页面的哪个地方分别对应接口文档里的哪些功能要事先沟通好 因为接口文档主要是我一个人在写 难免会出现和你们想法不一样的情况 所以你们在开发过程中任何关于接口文档的问题如果不清楚一定要找我沟通 觉得不合理的地方也可以提出来让我修改 接口文档会尽量按照你们的需求去写

- 功能大致分为下面几个部分

  但为了分层解耦 便于方法复用 体现开发 "高聚合 低耦合" 的观念 并没有将一个界面的功能全部写在一个模块

  例如在首页 需要进行 "文件上传" 功能 但是这个功能或许可能在其他地方也用得到

  所以会把这个功能单独拿出来写 方便后续修改功能或增加新功能

  避免代码冗长和重复

- 如果接口文档有关于功能的大更新 github仓库中 "更新日志" 文件会同步接口文档的更新内容 请在开发新的功能前阅读此日志 了解更新情况 由于接口文档的功能排列顺序和实际开发的顺序不一样 上面解释过了 所以不了解的地方可以看更新日志 来确定自己的开发顺序

- 另外注意参数的大小写 前端和java都是区分大小写的语言!!!!!

## 1. 主页功能

### 1.1 添加病例信息

#### 1.1.1 基本信息

- 请求路径: /home
- 请求方式: post
- 接口描述: 用于新添加一个病例的信息 包括眼部图片 信息+图片视为一次请求

#### 1.3.2 请求参数

- 参数格式: json
- 参数说明: 注意表中必须字段需要前端做非空或长度约束

| 参数名称 | 是否必须 | 示例                                                         | 备注         |
| :------- | -------- | ------------------------------------------------------------ | ------------ |
| name     | 是       | 张小红                                                       | 病例名字     |
| age      | 是       | 20                                                           | 病例年龄     |
| gender   | 是       | 1                                                            | 1男 0女 性别 |
| phone    | 是       | 12332112345                                                  | 手机号码     |
| idCard   | 是       | 400000000000000001                                           | 身份证号     |
| leftImg  | 是       | https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg | 左眼图片     |
| rightImg | 是       | https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg | 右眼图片     |

- 请求参数样例: 

  ```JSON
  {
    "name": "张小红",
    "age": "20",
    "gender": 1,
    "phone": "12332112345",
    "idCard": "400000000000000001",
    "leftImg": "https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg",
    "rightImg": "https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg"
  }
  ```

  > !!! 注意: 
  >
  > 文件/图片上传有两部分组成 你这里请求时的url就是你在发送上传文件的请求后 我给你返回的url 你需要发送请求给我 我把它加入到数据库中对应的病例信息中 上传文件的部分见 “文件上传”接口

#### 1.3.3 响应数据

- 参数格式: json

- 参数说明: 

| 名称 | 类型    | 是否必须 | 备注               |
| ---- | ------- | -------- | ------------------ |
| code | Integer | 是       | 响应码 1成功 0失败 |
| msg  | String  | 是       | 提示信息           |
| data | Object  | 是       | 返回的数据         |

- 响应数据样例:

```json
{
    "code":1,
    "msg":"success",
    "data":null
}
```

## 2. 病例管理

### 2.1 病例列表展示

#### 2.1.1 基本信息

- 请求路径: /patients
- 请求方式: get
- 接口描述: 用于所有病例的列表查询 (分页查询 条件查询)

#### 2.1.2 请求参数

- 参数格式: queryString

- 参数说明: 注意 必须的字段一定要在请求的url里面有 其他字段可以没有 也可以有且为空串

  此时即为查询所有病例列表(即条件查询的条件为空)

| 参数名称 | 是否必须 | 示例               | 备注                             |
| :------- | -------- | ------------------ | -------------------------------- |
| name     | 否       | 张三/张/三         | 姓名                             |
| gender   | 否       | 1                  | 性别 1男 0女                     |
| begin    | 否       | 2020-01-04         | 查询诊断日期(范围查询的起始日期) |
| end      | 否       | 2022-01-22         | 查询诊断日期(范围查询的结束日期) |
| phone    | 否       | 13212312123        | 电话号码                         |
| idCard   | 否       | 400000000000000001 | 身份证号                         |
| page     | 是       | 1                  | 页码 默认为1                     |
| pageSize | 是       | 10                 | 每页的数据行数 默认为10          |

- 请求参数样例: 

  /patients?name=张三&begin=2020-01-04&end=2022-01-22&page=1&pageSize=10

#### 2.1.3 响应数据

- 参数格式: json
- 参数说明: 

| 名称               | 类型          | 是否必须 | 备注                          |
| ------------------ | ------------- | -------- | ----------------------------- |
| code               | Integer       | 是       | 响应码 1成功 0失败            |
| msg                | String        | 是       | 提示信息                      |
| data               | Object        | 是       | 返回的数据                    |
| \|--total          | Integer       | 是       | 总记录数                      |
| \|--rows           | List<Patient> | 是       | 病例列表                      |
| --\|--id           | Integer       | 否       | id                            |
| --\|--name         | String        | 否       | 姓名                          |
| --\|--age          | Integer       | 否       | 年龄                          |
| --\|--gender       | Integer       | 否       | 性别                          |
| --\|--phone        | String        | 否       | 手机号码                      |
| --\|--idCard       | String        | 否       | 身份证号                      |
| --\|--doctorName   | String        | 否       | 诊断医生姓名                  |
| --\|--leftImg      | String        | 否       | 左眼照片                      |
| --\|--rightImg     | String        | 否       | 右眼照片                      |
| --\|--leftDiag     | String        | 否       | 左眼诊断关键字                |
| --\|--rightDiag    | String        | 否       | 右眼诊断关键字                |
| --\|--resInfo      | String        | 否       | 诊断结果信息                  |
| --\|--diagTime     | LocalDate     | 否       | 诊断日期                      |
| --\|--createTime   | LocalDateTime | 否       | 创建时间                      |
| --\|--updateTime   | LocalDateTime | 否       | 更新时间                      |
| --\|--illName      | String        | 否       | 患病名称 单一字符串 以 , 分隔 |
| --\|--queryIllName | List<String>  | 否       | 患病名称 字符串列表           |

- 响应数据样例: 

  ``` json
  {
      "code": 1,
      "msg": "success",
      "data": {
          "total": 20,
          "rows": [
              {
                  "id": 3,
                  "name": "周子杰",
                  "age": 42,
                  "gender": 1,
                  "phone": "12332100003",
                  "idCard": "400000000000000001",
                  "doctorName": "王小明",
                  "leftImg": "https://medicine-pic.oss-cn-beijing.aliyuncs.com/2_left.jpg",
                  "rightImg": "https://medicine-pic.oss-cn-beijing.aliyuncs.com/2_right.jpg",
                  "leftDiag": "激光斑点，轻度非增殖性视网膜病变",
                  "rightDiag": "轻度非增殖性视网膜病变",
                  "resInfo": "左眼：激光斑点，轻度非增殖性视网膜病变，右眼：轻度非增殖性视网膜病变。左眼可能由于糖尿病或高血压引起的视网膜病变，右眼也出现轻度非增殖性视网膜病变。建议控制血糖与血压，并定期检查视网膜健康。",
                  "diagTime": "2025-02-25",
                  "createTime": "2025-02-25T09:12:38",
                  "updateTime": "2025-02-25T09:12:38",
                  "illName": "其他疾病,糖尿病",
                  "queryIllName": [
                      "其他疾病",
                      "糖尿病"
                  ]
              }
          ]
      }
  }
  ```

### 2.1 删除病例

#### 2.1.1 基本信息

- 请求路径: /patients
- 请求方式: delete
- 接口描述: 根据id删除病例 支持批量删除

#### 2.1.2 请求参数

- 参数格式: array

- 参数说明: 

| 参数名称 | 是否必须 | 示例  | 备注           |
| :------- | -------- | ----- | -------------- |
| ids      | 是       | 1,2,3 | 要删除的病例id |

- 请求参数样例: 

  /patients?ids=1,2,3

#### 2.1.3 响应数据

- 参数格式: json

- 参数说明: 

| 名称 | 类型    | 是否必须 | 备注               |
| ---- | ------- | -------- | ------------------ |
| code | Integer | 是       | 响应码 1成功 0失败 |
| msg  | String  | 是       | 提示信息           |
| data | Object  | 是       | 返回的数据         |

- 响应数据样例:

```json
{
    "code":1,
    "msg":"success",
    "data":null
}
```

> 这里在删除病人数据时会同时删除病人在云端保存的图片 因此前端在发送请求时不需要额外发送删除云端图片的请求 一个病例被删除后 它在这个系统的历史诊断记录也会被清除

## 3. 数据统计

## 4. 登录系统

## 5. 文件上传

### 5.1  文件 (病人眼部图片) 上传

#### 5.1.1 基本信息

- 请求路径: /upload
- 请求方式: post
- 接口描述: 上传病人的眼部图片的接口

#### 5.1.2 请求参数

- 参数格式: multipart

- 参数说明: 

| 参数名称 | 是否必须 | 示例 | 备注           |
| :------- | -------- | ---- | -------------- |
| file     | 是       |      | 病人的眼部图片 |

#### 5.1.3 响应数据

- 参数格式: json

- 参数说明

| 参数名 | 类型    | 是否必须 | 备注                           |
| ------ | ------- | -------- | ------------------------------ |
| code   | Integer | 是       | 响应码，1 代表成功，0 代表失败 |
| msg    | String  | 是       | 提示信息                       |
| data   | object  | 是       | 返回的数据，上传图片的访问路径 |

响应数据样例：

```JSON
{
    "code": 1,
    "msg": "success",
    "data": "https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-0400.jpg"
}
```